<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Form</title> <!-- Page Title -->
  <link rel="icon" href="assets/images/clipart708931.png"> <!--Form Icon-->
  
  <!--  Google Fonts Links -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Bree+Serif&family=IBM+Plex+Serif:wght@400;700&display=swap" rel="stylesheet">
  <!-- CSS stylsheets Links -->
  <link rel="stylesheet" href="reset.css">
  <link rel="stylesheet" href="forms.css">
  <!-- Javascript Link (Page Transition Purposes) -->
  <script src="transition.js"></script>
</head>

<body>
  <!-- Page Header -->
  <header class="main-head">
    <div class="main-head-logo">
      <img src="assets/images/clipart708931.png" alt="pup-logo" class="pup-logo">
      <p>Polytechnic University of the Philippines</p>
    </div>
    <!-- Navigation Bar -->
    <nav class="main-head-nav">
      <ul>
        <li> <a href="index.html" onclick="changePage(event)"> HOME </a> </li>
        <li> <a href="apply.html" onclick="changePage(event)"> HOW TO APPLY </a> </li>
        <li> <a href="forms.html" onclick="changePage(event)"> FORM </a> </li>
        <li> <a href="about.html" onclick="changePage(event)"> ABOUT </a> </li>
      </ul>
    </nav>
  </header>

<!-- Submit Message -->
<section class="message-container">
  <div class="message" id="message"
  style="
    display: none;
    font-weight: bold;
    color: green;
    padding: 8px;
    background-color: beige;
    border-radius: 4px;
    border-color: aquamarine;
  "></div>
</section>
  <!-- Form Container -->
  <main>
    <section class="main">
      <!-- Form -->
      <form id="form" method="POST">
        <!-- Form First Page (STATUS) -->
        <section id="page1" class="form-page">
          <div class="page-button">
            <button class="stud-status-btn" href="#">
              <p>STATUS</p>
            </button>
            <div onclick="validateCheckbox()" class="stud-info-btn">
              <p>ID INFORMATION</p>
            </div> 
          </div>
          <h2>Application For New / Replacement of Identification Card</h2>
          <!-- <button onclick="nextPage()">Next</button> -->
          <!-- Student Status Checkboxes -->
          <section class="student-type-container">
            <p class="status-purpose">Choose your purpose:</p>
          
            <div class="transferee">
              <input type="checkbox" id="transferee" name="StudentType" value="transferee"/>
              <label for="transferee">Transferee</label>
            </div>

            <div class="shiftee">
              <input type="checkbox" id="shiftee" name="StudentType" value="shiftee" />
              <label for="shiftee">Shiftee</label>
            </div>

            <div class="late-filling">
              <input type="checkbox" id="late-filling" name="StudentType" value="late-filling" />
              <label for="late-filling">Late Filling</label>
            </div>

            <div class="damaged">
              <input type="checkbox" id="damaged" name="StudentType" value="damaged" />
              <label for="damaged">Damaged</label>
            </div>

            <div class="old-id">
              <input type="checkbox" id="old-id" name="StudentType" value="old-id" />
              <label for="old-filling">Old ID</label>
            </div>
            
            <div class="correction-of-entry">
              <input type="checkbox" id="correction-of-entry" name="StudentType" value="correction-of-entry" />
              <label for="correction-of-entry">Correction of Entry</label>
            </div>

            <p class="status-purpose">Choose your level of education:</p>

            <div class="lhs-shs">
              <input type="checkbox" id="lhs" name="StudentType" value="lhs" />
              <label for="lhs">LHS</label>

              <input type="checkbox" id="shs" name="StudentType" value="shs" />
              <label for="shs">SHS</label>
            </div>

            <div class="graduate-school">
              <input type="checkbox" id="graduate-school" name="StudentType" value="graduate-school" />
              <label for="graduate-school">Graduate School</label>
            </div>

            <div class="undergrad">
              <input type="checkbox" id="undergrad" name="StudentType" value="undergrad" />
              <label for="undergrad">Undergrad</label>
            </div>

            <div class="open-university">
              <input type="checkbox" id="open-university" name="StudentType" value="open-university" />
              <label for="open-university">Open University</label>
            </div>

            <div class="college-of-law">
              <input type="checkbox" id="college-of-law" name="StudentType" value="college-of-law" />
              <label for="college-of-law">College of Law</label>
            </div>

            <div class="institute-of-technology">
              <input type="checkbox" id="institute-of-technology" name="StudentType" value="institute-of-technology" />
              <label for="institute-of-technology">Institute of Technology</label>
            </div>
          </section>
          <!-- First Page Next Button -->
          <!-- Validate Checkboxes -->
          <p onclick="validateCheckbox()" class="next-btn">NEXT</p>
        </section>

        <!-- Form Second Page (ID INFORMATION)-->
        <section id="page2" class="form-page" style="display: none;">
          <div class="second-page-button">
            <button class="stud-info-btn" onclick="previousPage()">
              <p>STATUS</p>
            </button>
            <button href="#" class="stud-status-second-btn">
              <p>ID INFORMATION</p>
            </button> 
          </div>
          <div class="id-information-container">
            <h2>ID Information</h2>
            <!-- Second Page Input Fields -->
            <div class="id-first-row">
              <label for="student-number">Student Id</label>
              <label for="first-name">First Name</label>
              <label for="middle-name">Middle Name</label>
              <label for="last-name">Last Name</label>

              <input class="input" type="text" id="student-number" name="StudentID" pattern="[0-9]{4}-[0-9]{5}-MN-[0-9]{1}" placeholder="xxxx-xxxx-MN-x" required title="Input valid Student ID">
              <input class="input" type="text" id="first-name" name="FirstName" title="First Name" required>
              <input class="input" type="text" id="middle-name" name="MiddleName" title="Middle Name" required>
              <input class="input" type="text" id="last-name" name="LastName" title="Last Name" required>
            </div>


            <div class="id-second-row">
              <label for="gender" title="Select your gender">Gender</label>
              <label for="date-of-birth">Date of Birth</label>
              <label for="college">College</label>
              
              <div class="gender">
                <input type="radio" id="gender" name="Gender" value="Male" required>  
                <p>Male</p>
                <input type="radio" id="gender" name="Gender" value="Female" required>
                <p>Female</p>
              </div>

              <input type="date" class="input" id="date-of-birth" name="Birthdate" max="2010-12-31" title="Birthdate must start from 2010-12-31 or earlier" required>
              <select id="college" name="College" required onchange="validateSelect(this)">
                <option value="" disabled selected>Select an option</option>
                <option value="CAF">CAF - College of Accountancy and Finance</option>
                <option value="CADBE">CADBE - College of Architecture, Design and the Built Environment</option>
                <option value="CAL">CAL - College of Arts and Letters</option>
                <option value="CBA">CBA - College of Business Administration</option>
                <option value="COC">COC - College of Communication</option>
                <option value="CCIS">CCIS - College of Computer and Information Sciences</option>
                <option value="COED">COED - College of Education</option>
                <option value="CE">CE - College of Engineering</option>
                <option value="CHK">CHK - College of Human Kinetics</option>
                <option value="CL">CL - College of Law</option>
                <option value="CPSPA">CPSPA - College of Political Science and Public Adminitrator</option>
                <option value="CS">CS - College of Science</option>
                <option value="CTHTM">CTHTM - College of Tourism, Hospitality and Transportation Management</option>
              </select>
            </div>


            <div class="id-third-row">
              <label for="course-section">Course, Yr. & Section</label>
              <label for="phone-number">Phone/Mobile no.</label>
              <label for="email">Email address</label>

              <input type="text" class="input" id="course-section" name="CourseandSection" title="Enter your section" required>
              <input type="tel" class="input" id="telephone" name="PhoneNo" required placeholder="xxxx-xxx-xxxx" maxlength="13" pattern="[0-9]{4}-[0-9]{3}-[0-9]{4}" title="Follow the given format">
              <input type="email" class="input" id="email" name="EmailAddress" required title="Enter a valid email address" placeholder="example@gmail.com">
            </div>


            <div class="id-fourth-row">
              <label for="address">Address</label>
              <input type="text" class="input" id="address" name="Address" maxLength = "85" required title="Address should not exceed 85 characters">
            </div>
            

            <div class="id-fifth-row">
              <p>In case of emergency, please notify:</p>
            </div>

            <div class="id-sixth-row">
              <label for="emergency-name">Complete Name</label>
              <label for="emergency-phone">Phone/Mobile no.</label>
              <input type="text" class="input" id="emergency-name" name="EmergencyCompleteName" required title="Enter contact person's full name">
              <input type="tel" class="input" id="emergency-phone" name="EmergencyPhoneNo." required placeholder="xxxx-xxx-xxxx" maxlength="13" pattern="[0-9]{4}-[0-9]{3}-[0-9]{4}" title="Follow the given format">
            </div>
            

            <div class="id-seventh-row">
              <label for="emergency-address">Address</label>
              <input type="text" class="input" id="emergency-address" name="EmergencyAddress" required maxlength="85" title="Address should not exceed 85 characters">
            </div>

            <div class="id-eighth-row">
              <!-- Second Page BACK Button -->
              <p onclick="previousPage()" class="back-btn">BACK</p>
              <!-- Submit Button -->
              <!-- Validate All Input Fields -->
              <input type="submit" onclick="validateInput(), validateSelect(this), validateTelephone()" id="submit-button" title="Kindly double-check your answer before submitting">
            </div>
          </div>
        </section>
      </form>
    </section>
  </main>

  <!-- Page Footer -->
  <footer>
    <!-- Contacts -->
    <div class="contact">
      <span>CONTACT US </span>
      <p>Phone: (+63 2) 5335-1PUP (5335-1787) or 5335-1777 <br></p>
      <p>Email: inquire@pup.edu.ph</p>
    </div>
    <p class="footer-copyright">
      Â© 1998-2021 POLYTECHNIC UNIVERSITY OF THE PHILIPPINES
    </p>
    <!-- Social Medias -->
    <div class="footer-sm-container">
      <span>KEEP IN TOUCH </span>
      <div class="footer-logo-container">
        <a class="sm-fb" href="https://web.facebook.com/ThePUPOfficial"></a>
        <a class="sm-tt"></a>
        <a class="sm-ig"></a>
      </div>
    </div>
  </footer>
  <!-- Appscript Connection & Input Fields Validations -->
  <script>
    // Form NEXT Function
    function nextPage() {
        document.getElementById('page' + currentPage).style.display = 'none';
        currentPage++;
        document.getElementById('page' + currentPage).style.display = 'block';
    }
    // Form PREVIOUS Function
    function previousPage() {
        document.getElementById('page' + currentPage).style.display = 'none';
        currentPage--;
        document.getElementById('page' + currentPage).style.display = 'block';
    }


    var currentPage = 1;
    var count = 1;
    
    function validateCheckbox() {
      var checkboxes = document.getElementsByName("StudentType");
      var checked = false;
      for (var i = 0; i < checkboxes.length; i++) {
          if (checkboxes[i].checked) {
              checked = true;
              count = 1;
          }
      }
      if (!checked) {
          alert("Please check at least one checkbox");
          return false; // prevent form submission
      }
      if (count = 1){
        nextPage()
      }
      return true; // allow form submission
    }
    function validateTelephone() {
            // Get the telephone input value
      var telephoneInput = document.getElementById('telephone').value;
      var inputField = document.getElementById('telephone');

      // Define a regular expression pattern for valid telephone input
      var pattern = /^[0-9\-]+$/;

    // Check if the input matches the pattern
      if (pattern.test(telephoneInput)) {
          return true;
      } else {
          inputField.classList.add('invalid');
          return false;
      }
    }

    // Iterate over each field and perform validation
    function validateInput() {
      var fieldIds = [
      'student-number', 'first-name', 'middle-name', 'last-name', 'gender',
      'date-of-birth', 'college', 'course-section', 'telephone', 'email',
      'address', 'emergency-name', 'emergency-phone', 'emergency-address'
    ];


    for (var i = 0; i < fieldIds.length; i++) {
      var inputField = document.getElementById(fieldIds[i]);

      if (inputField.value.trim() === '') {
        inputField.classList.add('invalid');
      } else {
        inputField.classList.remove('invalid');
      }
      }
    }

    function validateSelect(selectElement) {
      var mySelect = document.getElementById('college');

      // Check if the selected option is disabled
      if (mySelect.options[mySelect.selectedIndex].disabled) {
        // Add the 'invalid' class to change the border color
        document.getElementById("college").style.borderColor = "red";
      } else {
        // Remove the 'invalid' class
        selectElement.classList.add('valid');
        document.getElementById("college").style.borderColor = "green";

      }
    }


    document.getElementById("form").addEventListener("submit", function (e) {
    e.preventDefault(); // Prevent the default form submission
    document.getElementById("message").textContent = "Submitting..";
    document.getElementById("message").style.display = "block";
    document.getElementById("submit-button").disabled = true;

    // Collect the form data
    var formData = new FormData(this);


    // Process checkbox values
    var studentTypeValues = [];
    var checkboxes = document.querySelectorAll('input[type=checkbox][name="StudentType"]:checked');
    checkboxes.forEach(function(checkbox) {
      studentTypeValues.push(checkbox.value);
    });

    // Add checkbox values to formData
    formData.append('StudentType', studentTypeValues.join(', '));

    // Send a POST request to your Google Apps Script
    fetch(
      "https://script.google.com/macros/s/AKfycbyPbEHyT4OpzsdjarBZ7kFmyPeOQ3ANTf2VodFvq6UyN97k0yq09n6peleb7Uh7YuTf/exec",
      {
        redirect: "follow",
        method: "POST",
        body: new URLSearchParams(formData).toString(),
        headers: {
          "Content-Type": "application/x-www-form-urlencoded",
        },
      }
    )
    .then(function (response) {
      // Check if the request was successful
      if (response) {
        return response; // Assuming your script returns JSON response
      } else {
        throw new Error("Failed to submit the form.");
      }
    })
    .then(function (data) {
      // Display a success message
      document.getElementById("message").textContent =
        "Data submitted successfully!";
      document.getElementById("message").style.display = "block";
      document.getElementById("message").style.backgroundColor = "green";
      document.getElementById("message").style.color = "beige";
      document.getElementById("submit-button").disabled = false;
      document.getElementById("form").reset();
      previousPage();

      setTimeout(function () {
        document.getElementById("message").textContent = "";
        document.getElementById("message").style.display = "none";
      }, 2600);
    })
    .catch(function (error) {
      // Handle errors, you can display an error message here
      console.error(error);
      document.getElementById("message").textContent =
        "An error occurred while submitting the form.";
      document.getElementById("message").style.display = "block";
      });
    });
  </script>
  
</body>
</html>